<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KDP Factory v2.0 (Pro)</title>
<style>
/* PROFESSIONAL UI STYLING */
body { margin: 0; padding: 0; background: #f0f2f5; font-family: 'Inter', system-ui, sans-serif; color: #1c1e21; }

.app-container {
  display: grid;
  grid-template-columns: 320px 1fr;
  height: 100vh;
}

/* SIDEBAR SETTINGS */
.sidebar {
  background: #fff;
  padding: 25px;
  border-right: 1px solid #ddd;
  overflow-y: auto;
  box-shadow: 2px 0 10px rgba(0,0,0,0.05);
  z-index: 10;
}

.logo { font-size: 1.2rem; font-weight: 900; color: #232f3e; margin-bottom: 30px; display: flex; align-items: center; gap: 8px; }
.logo span { color: #ff9900; }

.control-group { margin-bottom: 20px; }
.label { font-size: 0.75rem; font-weight: 700; color: #555; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 0.5px; }

input, select {
  width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;
  font-size: 0.95rem; background: #fff; transition: 0.2s; box-sizing: border-box;
}
input:focus, select:focus { border-color: #ff9900; outline: none; }

.btn {
  width: 100%; padding: 14px; background: #232f3e; color: #fff; border: none;
  border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px;
  transition: transform 0.1s;
}
.btn:hover { background: #37475a; }
.btn-secondary { background: #fff; color: #232f3e; border: 2px solid #232f3e; }
.btn-download { background: #ff9900; color: #000; }

/* CANVAS PREVIEW AREA */
.preview-area {
  background: #e9eaed;
  display: flex; justify-content: center; align-items: center;
  padding: 40px;
  position: relative;
  overflow: auto;
}

.canvas-wrapper {
  box-shadow: 0 20px 50px rgba(0,0,0,0.2);
  background: #fff;
  transition: transform 0.3s ease;
}

/* INFO BADGES */
.badge {
  display: inline-block; padding: 4px 8px; background: #e0f2fe; 
  color: #0284c7; border-radius: 4px; font-size: 0.7rem; font-weight: 600; margin-bottom: 5px;
}

/* PRINT OPTIMIZATION */
@media print {
  .sidebar, .preview-ui-controls { display: none !important; }
  .app-container { display: block; height: auto; }
  .preview-area { background: white; padding: 0; display: block; }
  .canvas-wrapper { box-shadow: none; transform: none !important; }
  canvas { width: 100% !important; height: 100% !important; }
}
</style>
</head>
<body>

<div class="app-container">
  
  <div class="sidebar">
    <div class="logo">KDP <span>PRO</span> v2.0</div>
    
    <div class="control-group">
      <div class="badge">STEP 1: DIMENSIONS</div>
      <label class="label">Trim Size</label>
      <select id="size" onchange="draw()">
        <option value="6x9">6 x 9 inches (Standard)</option>
        <option value="8.5x11">8.5 x 11 inches (US Letter)</option>
        <option value="5x8">5 x 8 inches (Pocket)</option>
        <option value="8.25x11">8.25 x 11 (Hardcover)</option>
      </select>
    </div>

    <div class="control-group">
      <div class="badge">STEP 2: TEMPLATE</div>
      <label class="label">Interior Type</label>
      <select id="type" onchange="draw()">
        <option value="lined">üìù Lined Journal</option>
        <option value="dot">üìç Dot Grid (Bullet)</option>
        <option value="graph">üìê Graph Paper (4x4)</option>
        <option value="music">üéº Music Staff (High Value)</option>
        <option value="hexagon">‚¨° Hexagon (Gamers/Chem)</option>
      </select>
    </div>

    <div class="control-group">
      <label class="label">Header Text (Optional)</label>
      <input type="text" id="headerText" placeholder="e.g. Date: _______" onkeyup="draw()">
    </div>

    <div class="control-group">
      <div class="badge">STEP 3: SAFETY</div>
      <label class="label">Bleed Settings</label>
      <select id="bleed" onchange="draw()">
        <option value="no-bleed">No Bleed (Safer)</option>
        <option value="bleed">Full Bleed (Edge to Edge)</option>
      </select>
    </div>

    <div class="control-group" style="background:#fff3cd; padding:10px; border-radius:6px; border:1px solid #ffeeba;">
      <label class="label" style="color:#856404; display:flex; align-items:center; gap:5px;">
        <input type="checkbox" id="showGuides" onchange="draw()" checked style="width:auto;"> 
        Show "Amazon Safe Zone"
      </label>
      <small style="color:#856404; font-size:0.7rem;">Turn this OFF before saving!</small>
    </div>

    <button class="btn btn-download" onclick="downloadPDF()">Download Page (PDF)</button>
    <div style="text-align:center; margin-top:10px; font-size:0.75rem; color:#666;">
      Right-click image to save as JPG
    </div>

  </div>

  <div class="preview-area">
    <div id="canvas-container" class="canvas-wrapper">
      <canvas id="canvas"></canvas>
    </div>
  </div>

</div>

<script>
// CONFIG
const DPI = 300; // Print quality
const MM_TO_PX = DPI / 25.4;

function draw() {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  
  // 1. Get Values
  const sizeVal = document.getElementById('size').value;
  const type = document.getElementById('type').value;
  const bleed = document.getElementById('bleed').value;
  const showGuides = document.getElementById('showGuides').checked;
  const headerText = document.getElementById('headerText').value;

  // 2. Set Dimensions (Inches)
  let wIn, hIn;
  if(sizeVal === '6x9') { wIn = 6; hIn = 9; }
  else if(sizeVal === '8.5x11') { wIn = 8.5; hIn = 11; }
  else if(sizeVal === '5x8') { wIn = 5; hIn = 8; }
  else { wIn = 8.25; hIn = 11; }

  // 3. Bleed Adjustment
  // If bleed is ON, we must add 0.125" to width and 0.25" to height (top+bottom)
  let finalW = wIn;
  let finalH = hIn;
  
  if (bleed === 'bleed') {
    finalW += 0.125;
    finalH += 0.25;
  }

  // Set Canvas Size
  canvas.width = finalW * DPI;
  canvas.height = finalH * DPI;
  
  // CSS scaling for screen viewing (so it fits)
  const screenScale = 800 / canvas.height; 
  canvas.style.height = '800px';
  canvas.style.width = (canvas.width * screenScale / (DPI/96 * 3.125)) + 'px'; // approx calc for css aspect ratio

  // 4. Fill White Background
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // 5. Calculate Safe Margins (KDP Rules)
  // No Bleed: 0.375" inside, 0.25" outside (we'll use 0.5" safe all around to be sure)
  // Bleed: content must go to edge, but text must be inside safe zone.
  const margin = 0.5 * DPI; 
  
  ctx.fillStyle = '#111';
  ctx.strokeStyle = '#555';
  ctx.lineWidth = 2; // Thicker for print

  // --- DRAW PATTERNS ---
  
  // Header Text
  if(headerText) {
    ctx.font = `bold ${30}px Arial`;
    ctx.textAlign = 'right';
    ctx.fillText(headerText, canvas.width - margin, margin - 20);
  }

  if (type === 'lined') {
    const spacing = 0.35 * DPI; // ~9mm
    for (let y = margin; y < canvas.height - margin; y += spacing) {
      ctx.beginPath();
      ctx.moveTo(bleed === 'bleed' ? 0 : margin, y);
      ctx.lineTo(bleed === 'bleed' ? canvas.width : canvas.width - margin, y);
      ctx.stroke();
    }
  } 
  else if (type === 'dot') {
    const spacing = 0.25 * DPI;
    ctx.fillStyle = '#888';
    for (let y = margin; y < canvas.height - margin; y += spacing) {
      for (let x = margin; x < canvas.width - margin; x += spacing) {
        ctx.beginPath();
        ctx.arc(x, y, 2, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  }
  else if (type === 'music') {
    const staffGap = 20; // Distance between lines
    const staffSpace = 180; // Distance between staves
    for (let y = margin + 50; y < canvas.height - margin; y += staffSpace) {
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(margin, y + (i * staffGap));
        ctx.lineTo(canvas.width - margin, y + (i * staffGap));
        ctx.stroke();
      }
    }
  }
  else if (type === 'hexagon') {
    // Complex Hexagon Math
    const r = 25; // Radius
    const a = 2 * Math.PI / 6;
    ctx.lineWidth = 1;
    ctx.strokeStyle = '#ccc';
    
    // Grid logic (honeycomb offset)
    for (let y = margin; y + r * Math.sin(a) < canvas.height - margin; y += r * Math.sin(a)) {
      for (let x = margin, j = 0; x + r * (1 + Math.cos(a)) < canvas.width - margin; x += r * (1 + Math.cos(a)), y += (-1) ** j++ * r * Math.sin(a)) {
         drawHexagon(ctx, x, y, r);
      }
    }
  }

  // --- SAFETY GUIDES (RED LAYER) ---
  if (showGuides) {
    ctx.strokeStyle = 'rgba(255, 0, 0, 0.5)';
    ctx.lineWidth = 4;
    ctx.setLineDash([15, 10]); // Dashed line
    
    // Draw Safe Zone Box
    // KDP Safe zone is usually 0.375" from edge
    const safeM = 0.375 * DPI;
    ctx.strokeRect(safeM, safeM, canvas.width - (safeM*2), canvas.height - (safeM*2));
    
    // Label
    ctx.fillStyle = 'red';
    ctx.font = '30px Arial';
    ctx.textAlign = 'center';
    ctx.fillText("‚ö†Ô∏è AMAZON SAFE ZONE (KEEP TEXT INSIDE)", canvas.width/2, canvas.height/2);
  }
}

function drawHexagon(ctx, x, y, r) {
  const a = 2 * Math.PI / 6;
  ctx.beginPath();
  for (var i = 0; i < 6; i++) {
    ctx.lineTo(x + r * Math.cos(a * i), y + r * Math.sin(a * i));
  }
  ctx.closePath();
  ctx.stroke();
}

// PDF Download Trigger
function downloadPDF() {
  const showGuides = document.getElementById('showGuides');
  if(showGuides.checked) {
    alert("I turned off the Red Safety Lines for your print file.");
    showGuides.checked = false;
    draw(); // Redraw without lines
  }
  window.print();
  // Restore guides after a moment
  setTimeout(() => { showGuides.checked = true; draw(); }, 2000);
}

// Initial Draw
draw();
</script>

</body>
</html>
